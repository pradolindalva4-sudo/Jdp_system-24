<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DONY BURGUERS SUPREME - JDP INDUSTRIAL</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { 
            --gold-18k: linear-gradient(145deg, #bf953f 0%, #fcf6ba 20%, #b38728 40%, #fcf6ba 60%, #aa771c 80%, #fcf6ba 100%);
            --gold-solid: #d4af37;
            --dark: #000;
        }
        body { background: var(--dark); color: var(--gold-solid); font-family: 'Arial Black', sans-serif; margin: 0; padding: 110px 3% 120px 3%; user-select: none; -webkit-user-select: none; overflow-x: hidden; }
        
        /* HEADER INDUSTRIAL JDP */
        .header { position: fixed; top: 0; left: 0; right: 0; height: 95px; background: #000; border-bottom: 3px solid var(--gold-solid); z-index: 1000; display: flex; justify-content: space-between; align-items: center; padding: 0 5%; }
        .jdp-signature { font-size: 9px; color: var(--gold-solid); text-transform: uppercase; letter-spacing: 1px; }
        #secret-trigger { font-size: 22px; font-weight: 900; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #total-display { font-size: 26px; font-weight: 900; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .btn-google { background: var(--gold-18k); color: #000; border: none; padding: 6px 12px; border-radius: 5px; font-size: 11px; font-weight: bold; cursor: pointer; margin-right: 10px; box-shadow: 0 0 10px var(--gold-solid); }
        .btn-x-discreto { background: rgba(255, 0, 0, 0.1); color: rgba(255, 255, 255, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); padding: 4px 10px; border-radius: 4px; font-size: 14px; cursor: pointer; margin-left: 10px; }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: #050505; border: 1px solid #1a1a1a; border-radius: 10px; overflow: hidden; position: relative; height: 240px; }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-info { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); padding: 12px 5px; text-align: center; z-index: 2; }
        .card-info h4 { margin: 0; font-size: 0.8rem; text-transform: uppercase; color: #fff; letter-spacing: 1px; }
        .card-info .price { font-weight: 900; font-size: 1.2rem; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-confirmar { position: fixed; bottom: 25px; left: 5%; width: 90%; background: var(--gold-18k); color: #000; padding: 20px; border: none; border-radius: 12px; font-weight: 900; font-size: 1.7rem; z-index: 1100; }
        
        /* MODAL PAGAMENTO OURO */
        #modal-qrcode { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 20000; flex-direction: column; align-items: center; justify-content: center; border: 5px solid var(--gold-solid); }
        #qr-img { width: 85%; max-width: 350px; border: 10px solid #fff; border-radius: 15px; background: #fff; }
        .msg-ouro { background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.5rem; text-align: center; margin-bottom: 15px; font-weight: 900; }

        /* ESCRITÓRIO JDP */
        #escritorio-jdp { display: none; position: fixed; inset: 0; background: #000; z-index: 10000; padding: 20px; flex-direction: column; overflow-y: auto; border: 4px solid var(--gold-solid); }
        .section { border: 1px solid var(--gold-solid); padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        input { width: 94%; background: #111; border: 1px solid #333; color: #fff; padding: 12px; margin: 5px 0; border-radius: 5px; }
        .btn-jdp { background: var(--gold-18k); color: #000; border: none; padding: 15px; width: 100%; font-weight: 900; border-radius: 5px; margin-top: 10px; }
        
        #supreme-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        .gold-title { font-size: 12vw; font-weight: 900; white-space: nowrap; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; position: absolute; transform: translateX(-150%); }
        .slide-active { animation: slidePass 1s ease-in-out 3; }
        @keyframes slidePass { 0% { transform: translateX(-150%); } 50% { transform: translateX(0%); } 100% { transform: translateX(150%); } }
        #flash-container { display: none; width: 100%; height: 100%; align-items: center; justify-content: center; }
        #flash-img { max-width: 85%; border: 6px solid var(--gold-solid); }
        #final-resplendent { display: none; font-size: 13vw; font-weight: 900; text-align: center; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: pulseGold 2s infinite alternate; }
        @keyframes pulseGold { from { transform: scale(0.9); opacity: 0.8; } to { transform: scale(1.1); opacity: 1; } }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <div class="jdp-signature">Engenheiro José Divino Prado da Lapa</div>
            <div id="secret-trigger">DONY BURGUERS</div>
        </div>
        <div style="display: flex; align-items: center;">
            <button class="btn-google" onclick="abrirPagamento()">GOOGLE QR</button>
            <div id="total-display">R$ 0,00</div>
            <button class="btn-x-discreto" onclick="resetCarrinho()">X</button>
        </div>
    </div>

    <div class="grid" id="vitrine"></div>
    <button class="btn-confirmar" onclick="iniciarSequenciaJDP()">CONFIRMAR PEDIDO</button>

    <div id="modal-qrcode">
        <div class="msg-ouro">PAGAMENTO VIA PIX<br>JOSE DIVINO PRADO</div>
        <img id="qr-img" src="" alt="QR CODE PIX">
        <div id="timer-display" style="margin-top:20px; font-size:1.5rem; color: var(--gold-solid);">FECHANDO EM: 10s</div>
    </div>

    <div id="escritorio-jdp">
        <h1 style="text-align:center; background: var(--gold-18k); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ESCRITÓRIO JDP</h1>
        <div class="section">
            <h3>CADASTRAR PRODUTO</h3>
            <input type="text" id="inp-nome" placeholder="Nome">
            <input type="number" id="inp-preco" placeholder="Preço">
            <input type="text" id="inp-link" placeholder="Link Imagem">
            <input type="number" id="inp-estoque" placeholder="Estoque">
            <button class="btn-jdp" onclick="salvarProduto()">SALVAR NO SISTEMA</button>
        </div>
        <button onclick="document.getElementById('escritorio-jdp').style.display='none'" class="btn-jdp" style="background:#333; color:#fff;">SAIR</button>
    </div>

    <div id="supreme-overlay">
        <div id="gold-anim" class="gold-title">DONY BURGUERS</div>
        <div id="flash-container"><img id="flash-img" src=""></div>
        <div id="final-resplendent">DONY BURGUERS</div>
    </div>

    <script>
        // CHAVE PIX COPIA E COLA OFICIAL
        const pixCopiaECola = "00020126580014br.gov.bcb.pix013643a6f5e6-2934-495f-a96c-f7eaf67d28da5204000053039865802BR5925JOSE DIVINO PRADO DA LAPA6009SAO PAULO62580520SAN2026021402552811750300017br.gov.bcb.brcode01051.0.0630402E8";
        
        const firebaseConfig = { apiKey: "AIzaSyCEdXF7ScnMYz0Ce0OW-B_UJ8Bm5Pl9m8o", databaseURL: "https://dony-burguers-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let carrinho = [], produtos = [], processando = false;

        // MOTOR DE VOZ
        function iniciarVoz() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (SpeechRecognition) {
                const recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.lang = 'pt-BR';
                recognition.onresult = (e) => {
                    const comando = e.results[e.results.length - 1][0].transcript.toLowerCase();
                    if (comando.includes("qr code") || comando.includes("pagar")) abrirPagamento();
                };
                recognition.onerror = () => setTimeout(() => recognition.start(), 1000);
                recognition.onend = () => recognition.start();
                try { recognition.start(); } catch(err) {}
            }
        }
        document.body.addEventListener('click', () => iniciarVoz(), {once: true});

        function abrirPagamento() {
            const modal = document.getElementById('modal-qrcode');
            const qrImg = document.getElementById('qr-img');
            qrImg.src = "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=" + encodeURIComponent(pixCopiaECola);
            modal.style.display = 'flex';
            let seg = 10;
            const t = setInterval(() => {
                seg--;
                document.getElementById('timer-display').innerText = `FECHANDO EM: ${seg}s`;
                if(seg <= 0) { clearInterval(t); modal.style.display = 'none'; document.getElementById('timer-display').innerText = "FECHANDO EM: 10s"; }
            }, 1000);
        }

        // CARREGAR VITRINE
        db.ref('cardapio_supreme').on('value', snap => {
            const data = snap.val(); produtos = data ? Object.entries(data).map(([id, val]) => ({id, ...val})) : [];
            document.getElementById('vitrine').innerHTML = produtos.map(p => `
                <div class="card" onclick="add('${p.id}')">
                    <img src="${p.link}">
                    <div class="card-info"><h4>${p.nome}</h4><div class="price">R$ ${parseFloat(p.preco).toFixed(2)}</div></div>
                </div>`).join('');
        });

        function add(id) {
            const p = produtos.find(x => x.id === id);
            if(p.estoque <= 0) return alert("Esgotado!");
            carrinho.push(p);
            document.getElementById('total-display').innerText = `R$ ${carrinho.reduce((acc, i) => acc + parseFloat(i.preco), 0).toFixed(2)}`;
        }

        function resetCarrinho() { carrinho = []; document.getElementById('total-display').innerText = "R$ 0,00"; }

        // SEQUÊNCIA JDP COMPLETA (PEDIDO + ANIMAÇÃO + BAIXA ESTOQUE)
        async function iniciarSequenciaJDP() {
            if (carrinho.length === 0 || processando) return;
            processando = true;

            // Envia para o Firebase
            db.ref('PEDIDOS_PRODUCAO').push({ 
                itens: carrinho, 
                total: document.getElementById('total-display').innerText, 
                data: new Date().toLocaleString() 
            });

            // Baixa o estoque
            for(let item of carrinho) {
                db.ref('cardapio_supreme/' + item.id).update({ estoque: (item.estoque || 1) - 1 });
            }

            // Animação de Ouro
            const overlay = document.getElementById('supreme-overlay'), goldAnim = document.getElementById('gold-anim'), flashBox = document.getElementById('flash-container'), flashImg = document.getElementById('flash-img'), finalRes = document.getElementById('final-resplendent');
            overlay.style.display = 'flex'; goldAnim.classList.add('slide-active');
            await new Promise(r => setTimeout(r, 3000));
            goldAnim.style.display = 'none'; flashBox.style.display = 'flex';
            for (let p of produtos) { flashImg.src = p.link; await new Promise(r => setTimeout(r, 150)); }
            flashBox.style.display = 'none'; finalRes.style.display = 'block';
            await new Promise(r => setTimeout(r, 4000));
            
            overlay.style.display = 'none'; 
            finalRes.style.display = 'none'; 
            goldAnim.classList.remove('slide-active'); 
            goldAnim.style.display = 'block';
            
            alert("PEDIDO ENVIADO, ENGENHEIRO!");
            resetCarrinho(); 
            processando = false;
        }

        function salvarProduto() {
            const n = document.getElementById('inp-nome').value, p = document.getElementById('inp-preco').value, l = document.getElementById('inp-link').value, e = document.getElementById('inp-estoque').value;
            if(n && p && l) db.ref('cardapio_supreme').push({ nome: n, preco: p, link: l, estoque: parseInt(e) || 0 });
        }
    </script>
</body>
</html>
